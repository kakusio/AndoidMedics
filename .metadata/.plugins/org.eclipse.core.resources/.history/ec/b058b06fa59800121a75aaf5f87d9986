package com.example.nearshorenexus.Agenda;


import java.util.ArrayList;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import com.example.nearshorenexus.Tools.DownloadWeb;

import android.app.ProgressDialog;
import android.os.AsyncTask;

public class AsyncWebAPIAgenda extends AsyncTask<String, Integer, String>{
	private ProgressDialog progDialog;
	private AgendaActivity activity;
	
    public AsyncWebAPIAgenda(AgendaActivity activity) {
		super();
		this.activity = activity;
	}

	@Override
    protected void onPreExecute() {
        super.onPreExecute(); 
    	progDialog = ProgressDialog.show(this.activity, "Search", "Searching", true, false);
    }

    @Override
    protected String doInBackground(String... params) {
        try {
            return DownloadWeb.downloadFromServer(params);
        } catch (Exception e) {
            return new String();
        }
    }
    
    @Override
    protected void onPostExecute(String result) 
    {    	
    	ArrayList<Agendas> agenda = new ArrayList<Agendas>();
    	progDialog.dismiss();
        if (result.length() == 0) return;        
        try {
        	JSONObject jobj = new JSONObject(result);
			JSONArray jarray_agendas = jobj.getJSONArray("result");
			for(int i=0; i<jarray_agendas.length(); i++) {
				JSONObject jobj_agenda = jarray_agendas.getJSONObject(i);	
				agenda.add(new Agendas(jobj_agenda));		
			}			
		} catch (JSONException e) {
			e.printStackTrace();
		}
		
		this.activity.setAgenda(agenda);             
    }
}
